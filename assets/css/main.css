/* ============================================================
   NIHONHAN - Main CSS
   Variables, Reset, Global Styles
   ============================================================ */

@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Noto+Sans+SC:wght@300;400;500;700&family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@300;400;500;600&display=swap');

:root {
  /* Colors */
  --red:        #C0392B;
  --red-dark:   #922B21;
  --red-light:  #E74C3C;
  --red-soft:   #FADBD8;
  --gold:       #D4AF37;
  --gold-dark:  #B7950B;
  --gold-light: #F4D03F;
  --gold-soft:  #FEF9E7;
  --white:      #FFFFFF;
  --off-white:  #FAFAFA;
  --bg:         #F7F4F0;
  --surface:    #FFFFFF;
  --surface-2:  #F5F0EB;
  --border:     #E8DDD0;
  --border-2:   #D5C9BC;
  --text:       #1A1208;
  --text-2:     #5A4A3A;
  --text-3:     #9A8A7A;
  --shadow:     rgba(26,18,8,0.08);
  --shadow-md:  rgba(26,18,8,0.14);

  /* Fonts */
  --font-display: 'Playfair Display', 'Noto Sans JP', serif;
  --font-body:    'DM Sans', 'Noto Sans JP', sans-serif;
  --font-cjk:     'Noto Sans JP', 'Noto Sans SC', sans-serif;

  /* Sizes */
  --sidebar-w: 260px;
  --topbar-h:  60px;
  --bottomnav-h: 64px;
  --radius:    10px;
  --radius-lg: 16px;
  --radius-xl: 24px;

  /* Transitions */
  --ease: cubic-bezier(0.4, 0, 0.2, 1);
  --dur:  0.2s;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html { font-size: 16px; -webkit-text-size-adjust: 100%; scroll-behavior: smooth; }

body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
}

a { color: inherit; text-decoration: none; }
img { display: block; max-width: 100%; }
ul, ol { list-style: none; }
button { font-family: inherit; cursor: pointer; border: none; background: none; }
input, textarea, select { font-family: inherit; }

/* ── Typography ── */
h1, h2, h3, h4, h5 { font-family: var(--font-display); line-height: 1.3; }
h1 { font-size: 2rem; }
h2 { font-size: 1.5rem; }
h3 { font-size: 1.2rem; }
h4 { font-size: 1rem; }

.cjk { font-family: var(--font-cjk); }

/* ── Utility ── */
.sr-only { position: absolute; width: 1px; height: 1px; overflow: hidden; clip: rect(0,0,0,0); }
.text-center { text-align: center; }
.text-red   { color: var(--red); }
.text-gold  { color: var(--gold-dark); }
.text-muted { color: var(--text-3); }
.fw-600 { font-weight: 600; }
.fw-700 { font-weight: 700; }

/* ── Scrollbar ── */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border-2); border-radius: 99px; }
::-webkit-scrollbar-thumb:hover { background: var(--text-3); }

/* ── Focus ── */
:focus-visible { outline: 2px solid var(--gold); outline-offset: 2px; }

/* ── Animations ── */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes slideIn {
  from { opacity: 0; transform: translateX(-12px); }
  to   { opacity: 1; transform: translateX(0); }
}
@keyframes spin {
  to { transform: rotate(360deg); }
}
.fade-in  { animation: fadeIn  0.3s var(--ease) both; }
.slide-in { animation: slideIn 0.3s var(--ease) both; }

/* ── Toast ── */
#toast-container {
  position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
  z-index: 9999; display: flex; flex-direction: column; gap: 8px;
  align-items: center; pointer-events: none;
}
@media (min-width: 769px) {
  #toast-container { bottom: 24px; right: 24px; left: auto; transform: none; }
}
.toast {
  background: var(--text); color: #fff;
  padding: 10px 20px; border-radius: 99px;
  font-size: 0.875rem; font-weight: 500;
  pointer-events: auto; white-space: nowrap;
  animation: fadeIn 0.3s var(--ease) both;
  box-shadow: 0 4px 16px var(--shadow-md);
}
.toast.success { background: #27AE60; }
.toast.error   { background: var(--red); }
.toast.warning { background: var(--gold-dark); }
.toast.xp      { background: #8e44ad; font-weight: 700; letter-spacing: 0.5px; }
.toast.levelup { background: linear-gradient(90deg, #e67e22, #f39c12); font-weight: 700; font-size: 0.95rem; }
.toast.hide    { animation: fadeIn 0.25s var(--ease) reverse both; }

/* ============================================================
   DARK MODE (Fase 10)
   [data-theme="dark"] overrides semua CSS variables
   ============================================================ */

[data-theme="dark"] {
  /* Backgrounds */
  --bg:         #0f0f13;
  --surface:    #1a1a22;
  --surface-2:  #222230;
  --off-white:  #1a1a22;

  /* Borders */
  --border:     #2e2e3a;
  --border-2:   #3a3a4a;

  /* Text */
  --text:       #e8e8f0;
  --text-2:     #a8a8c0;
  --text-3:     #686880;

  /* Shadows */
  --shadow:     rgba(0,0,0,0.3);
  --shadow-md:  rgba(0,0,0,0.5);

  /* Accents — tetap tapi lebih lembut */
  --red-soft:   rgba(192,57,43,0.18);
  --gold-soft:  rgba(212,175,55,0.12);

  color-scheme: dark;
}

/* Transisi mulus saat ganti tema */
html {
  transition:
    background-color var(--dur) var(--ease),
    color var(--dur) var(--ease);
}

/* ── Dark mode — komponen spesifik ── */

/* Drawer overlay lebih gelap */
[data-theme="dark"] .drawer-overlay {
  background: rgba(0,0,0,0.65);
}

/* Tombol theme toggle di topbar */
.theme-toggle-btn {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: var(--surface-2);
  border: 1.5px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 1rem;
  line-height: 1;
  transition: background var(--dur), border-color var(--dur), transform 0.15s;
  flex-shrink: 0;
}
.theme-toggle-btn:hover {
  background: var(--red-soft);
  border-color: var(--red);
  transform: scale(1.08);
}

/* Auth pages — form panel background */
[data-theme="dark"] .auth-form-panel {
  background: var(--surface);
}
[data-theme="dark"] .form-control {
  background: var(--surface-2);
  border-color: var(--border);
  color: var(--text);
}
[data-theme="dark"] .form-control:focus {
  background: var(--bg);
  border-color: var(--gold);
}
[data-theme="dark"] .form-control::placeholder {
  color: var(--text-3);
}

/* Input select di settings */
[data-theme="dark"] select.form-control {
  background: var(--surface-2);
}

/* Flashcard dark */
[data-theme="dark"] .flashcard-inner {
  filter: none;
}
[data-theme="dark"] .flashcard-front,
[data-theme="dark"] .flashcard-back {
  background: var(--surface);
  border-color: var(--border);
  color: var(--text);
}

/* Quiz cards */
[data-theme="dark"] .quiz-option {
  background: var(--surface);
  border-color: var(--border);
  color: var(--text);
}
[data-theme="dark"] .quiz-option:hover {
  background: var(--surface-2);
  border-color: var(--red);
}

/* Heatmap level-0 lebih gelap */
[data-theme="dark"] .heatmap-cell.level-0 {
  background: var(--border);
}

/* Stroke widget */
[data-theme="dark"] .stroke-canvas {
  filter: invert(1) hue-rotate(180deg);
}

/* CJK karakter — sedikit lebih terang agar terbaca */
[data-theme="dark"] .char-detail-big,
[data-theme="dark"] .hanzi-cell-char,
[data-theme="dark"] .cjk {
  opacity: 1;
}

/* Scrollbar dark */
[data-theme="dark"] ::-webkit-scrollbar-track {
  background: var(--bg);
}
[data-theme="dark"] ::-webkit-scrollbar-thumb {
  background: var(--border-2);
}

/* Kanji modal — stroke widget */
[data-theme="dark"] #modal-stroke-widget canvas {
  filter: invert(0.85);
}

/* Profile hero — tetap gradient merah, tidak terpengaruh */
[data-theme="dark"] .profile-hero {
  /* Gradient sudah pakai merah solid, oke */
}

/* Reset module btn */
[data-theme="dark"] .reset-module-btn {
  background: var(--surface-2);
}

/* Local notice / info box */
[data-theme="dark"] .local-notice {
  background: rgba(212,175,55,0.08);
  border-color: rgba(212,175,55,0.3);
}

/* Auth left panel tetap merah */
[data-theme="dark"] .auth-left-panel {
  /* biarkan tetap merah */
}

/* ── Dark mode — spesifik komponen dengan warna hardcoded ── */

/* Toggle slider thumb */
[data-theme="dark"] .toggle-slider::before {
  background: #ddd;
}

/* HSK badges dark */
[data-theme="dark"] .hsk-1 {
  background: rgba(26,82,118,0.25);
  color: #7ec8e3;
}
[data-theme="dark"] .hsk-2 {
  background: rgba(26,122,90,0.25);
  color: #7ed9b8;
}
[data-theme="dark"] .hsk-3 {
  background: rgba(125,60,152,0.25);
  color: #c8a0e3;
}

/* Auth form bg */
[data-theme="dark"] .form-field-wrap,
[data-theme="dark"] .auth-form-right {
  background: var(--surface);
}

/* Local notice / info kuning */
[data-theme="dark"] .local-notice,
[data-theme="dark"] .auth-local-notice {
  background: rgba(212,175,55,0.08);
  border-color: rgba(212,175,55,0.3);
  color: var(--text-2);
}

/* Password strength bar */
[data-theme="dark"] .strength-bar-seg {
  background: var(--border);
}

/* Pinyin modal inner */
[data-theme="dark"] .pinyin-modal-inner,
[data-theme="dark"] .char-modal-inner,
[data-theme="dark"] .kanji-modal-inner,
[data-theme="dark"] .hanzi-modal {
  background: var(--surface);
  border-color: var(--border);
}

/* Tab buttons */
[data-theme="dark"] .tab-btn {
  color: var(--text-2);
  border-color: var(--border);
}
[data-theme="dark"] .tab-btn.active {
  background: var(--red-soft);
  color: var(--red);
  border-color: var(--red);
}

/* Filter buttons */
[data-theme="dark"] .filter-btn,
[data-theme="dark"] .klp-btn,
[data-theme="dark"] .theme-tab {
  background: var(--surface-2);
  border-color: var(--border);
  color: var(--text-2);
}
[data-theme="dark"] .filter-btn.active,
[data-theme="dark"] .klp-btn.active,
[data-theme="dark"] .theme-tab.active {
  background: var(--red-soft);
  color: var(--red);
  border-color: var(--red);
}

/* Quiz mini */
[data-theme="dark"] .qm-choice {
  background: var(--surface);
  border-color: var(--border);
  color: var(--text);
}
[data-theme="dark"] .qm-choice:hover:not(:disabled) {
  border-color: var(--red);
  background: var(--red-soft);
}

/* Progress bars */
[data-theme="dark"] .progress-bar-bg {
  background: var(--border);
}

/* Vocab card */
[data-theme="dark"] .vocab-card {
  background: var(--surface);
  border-color: var(--border);
}
[data-theme="dark"] .vocab-card.learned {
  background: var(--surface-2);
  border-color: rgba(212,175,55,0.4);
}

/* Char cell */
[data-theme="dark"] .char-cell {
  background: var(--surface);
  border-color: var(--border);
}
[data-theme="dark"] .char-cell.learned {
  background: rgba(212,175,55,0.08);
  border-color: rgba(212,175,55,0.4);
}

/* Hanzi cell */
[data-theme="dark"] .hanzi-cell {
  background: var(--surface);
  border-color: var(--border);
}
[data-theme="dark"] .hanzi-cell.learned {
  background: rgba(212,175,55,0.08);
  border-color: rgba(212,175,55,0.4);
}

/* Pinyin cell */
[data-theme="dark"] .pinyin-cell {
  background: var(--surface);
  border-color: var(--border);
}
[data-theme="dark"] .pinyin-cell:hover {
  background: var(--surface-2);
}

/* Quiz module card */
[data-theme="dark"] .quiz-module-card {
  background: var(--surface);
  border-color: var(--border);
}
[data-theme="dark"] .quiz-module-card:hover {
  border-color: var(--red);
}

/* Grammar card */
[data-theme="dark"] .grammar-card {
  background: var(--surface);
  border-color: var(--border);
}

/* Kanji cell */
[data-theme="dark"] .kanji-cell {
  background: var(--surface);
  border-color: var(--border);
}
[data-theme="dark"] .kanji-cell.learned {
  background: rgba(212,175,55,0.08);
  border-color: rgba(212,175,55,0.4);
}

/* Stats card */
[data-theme="dark"] .stat-card {
  background: var(--surface);
  border-color: var(--border);
}

/* Dashboard module progress */
[data-theme="dark"] .module-item {
  background: var(--surface);
}

/* Topbar + mobile topbar */
[data-theme="dark"] .topbar,
[data-theme="dark"] .mobile-topbar {
  background: var(--surface);
  border-color: var(--border);
}

/* Sidebar */
[data-theme="dark"] .sidebar {
  background: var(--surface);
  border-color: var(--border);
}
